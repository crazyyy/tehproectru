/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","esri.toolbars._GraphicMover"],["require","dojox.gfx.move"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["esri.toolbars._GraphicMover"]){_4._hasResource["esri.toolbars._GraphicMover"]=true;_4.provide("esri.toolbars._GraphicMover");_4.require("dojox.gfx.move");_4.declare("esri.toolbars._Mover",_6.gfx.Mover,{constructor:function(_7,e,_8){this.__e=e;}});_4.declare("esri.toolbars._GraphicMover",null,{constructor:function(_9,_a,_b){this.graphic=_9;this.map=_a;this.toolbar=_b;this._enableGraphicMover();this._moved=false;},refresh:function(_c){var _d=this.graphic.getDojoShape();if(_d&&(_c||!_d._hostGraphic)){this._disableGraphicMover();this._enableGraphicMover();}},destroy:function(){this._disableGraphicMover();},hasMoved:function(){return this._moved;},_enableGraphicMover:function(){var _e=this.graphic;var _f=_e.getDojoShape();if(_f){_f._hostGraphic=_e;this._moveable=new _6.gfx.Moveable(_f,{mover:esri.toolbars._Mover});this._moveStartHandle=_4.connect(this._moveable,"onMoveStart",this,this._moveStartHandler);this._firstMoveHandle=_4.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=_4.connect(this._moveable,"onMoving",this,this._movingHandler);this._moveStopHandle=_4.connect(this._moveable,"onMoveStop",this,this._moveStopHandler);var _10=_f.getEventSource();if(_10){_4.style(_10,"cursor",this.toolbar._cursors.move);}}},_disableGraphicMover:function(){var _11=this._moveable;if(_11){_4.disconnect(this._moveStartHandle);_4.disconnect(this._firstMoveHandle);_4.disconnect(this._movingHandle);_4.disconnect(this._moveStopHandle);var _12=_11.shape;if(_12){_12._hostGraphic=null;var _13=_12.getEventSource();if(_13){_4.style(_13,"cursor",null);}}_11.destroy();}this._moveable=null;},_moveStartHandler:function(){var _14=this.graphic;this._startTx=_14.getDojoShape().getTransform();if(this.graphic.geometry.type==="point"){var map=this.map;if(map.snappingManager){map.snappingManager._setUpSnapping();}}this.toolbar.onGraphicMoveStart(_14);},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic);},_movingHandler:function(_15){this.toolbar.onGraphicMove(this.graphic,_15.shape.getTransform());},_moveStopHandler:function(_16){var _17=this.graphic,map=this.map,mx=_6.gfx.matrix,_18=_17.geometry,_19=_18.type,_1a=_17.getDojoShape(),tx=_1a.getTransform();if(_4.toJson(tx)!==_4.toJson(this._startTx)){this._moved=true;switch(_19){case "point":var _1b=[tx,mx.invert(this._startTx)];var _1c;if(map.snappingManager){_1c=map.snappingManager._snappingPoint;}_18=_1c||map.toMap(mx.multiplyPoint(_1b,map.toScreen(_18,true)));if(map.snappingManager){map.snappingManager._killOffSnapping();}break;case "polyline":_18=this._updatePolyGeometry(_18,_18.paths,tx);break;case "polygon":_18=this._updatePolyGeometry(_18,_18.rings,tx);break;}_1a.setTransform(null);_17.setGeometry(_18);}else{this._moved=false;}this.toolbar._endOperation("MOVE");this.toolbar.onGraphicMoveStop(_17,tx);if(!this._moved){var e=_16.__e,_1d=this.map.position,pt=new esri.geometry.Point(e.pageX-_1d.x,e.pageY-_1d.y);this.toolbar.onGraphicClick(_17,{screenPoint:pt,mapPoint:this.map.toMap(pt)});}},_updatePolyGeometry:function(_1e,_1f,_20){var map=this.map;var _21=_1e.getPoint(0,0);var _22=map.toMap(map.toScreen(_21).offset(_20.dx,_20.dy));var _23=_22.x-_21.x;var _24=_22.y-_21.y;for(var i=0;i<_1f.length;i++){var seg=_1f[i];for(var j=0;j<seg.length;j++){var _25=_1e.getPoint(i,j);_1e.setPoint(i,j,_25.offset(_23,_24));}}return _1e;}});}}};});